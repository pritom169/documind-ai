graph TB
    subgraph Client["Client Layer"]
        REST["REST API Client"]
        WS["WebSocket Client"]
    end

    subgraph Django["Django Application"]
        DRF["Django REST Framework<br/><i>JWT Auth · Rate Limiting · API Keys</i>"]
        Channels["Django Channels<br/><i>WebSocket Streaming</i>"]
    end

    subgraph Agents["LangGraph Multi-Agent System"]
        Router["Router Node<br/><i>Query Analysis & Classification</i>"]
        Retriever["Retriever Node<br/><i>Hybrid Search + Re-ranking</i>"]

        subgraph Specialists["Specialist Agents"]
            QA["QA Agent<br/><i>Factual Answers</i>"]
            Research["Research Agent<br/><i>Multi-source Synthesis</i>"]
            Summarise["Summarise Agent<br/><i>Document Summaries</i>"]
            Analyse["Analyse Agent<br/><i>Comparative Analysis</i>"]
        end
    end

    subgraph Processing["Async Processing"]
        Celery["Celery Workers<br/><i>Document Ingestion</i>"]
        Beat["Celery Beat<br/><i>Scheduled Tasks</i>"]
    end

    subgraph Storage["Data Layer"]
        PG["PostgreSQL 16<br/><i>Users · Documents · Conversations</i>"]
        Qdrant["Qdrant<br/><i>Vector Embeddings</i>"]
        Redis["Redis<br/><i>Cache · Sessions · Channels</i>"]
    end

    subgraph LLM["LLM Providers"]
        Azure["Azure OpenAI<br/><i>GPT-4o</i>"]
        Bedrock["AWS Bedrock<br/><i>Claude 3.5 Sonnet</i>"]
    end

    subgraph Infra["Infrastructure"]
        K8s["Kubernetes<br/><i>HPA · Ingress · TLS</i>"]
        Prom["Prometheus<br/><i>Metrics Collection</i>"]
        Graf["Grafana<br/><i>Dashboards</i>"]
    end

    REST --> DRF
    WS --> Channels
    DRF --> Router
    Channels --> Router
    Router --> Retriever
    Retriever --> QA
    Retriever --> Research
    Retriever --> Summarise
    Retriever --> Analyse
    Retriever --> Qdrant
    QA & Research & Summarise & Analyse --> LLM
    DRF --> Celery
    Celery --> PG
    Celery --> Qdrant
    Beat --> Celery
    DRF --> PG
    Channels --> Redis
    Prom --> Graf

    classDef client fill:#e1f5fe,stroke:#0288d1,color:#01579b
    classDef django fill:#e8f5e9,stroke:#388e3c,color:#1b5e20
    classDef agent fill:#fff3e0,stroke:#f57c00,color:#e65100
    classDef storage fill:#f3e5f5,stroke:#7b1fa2,color:#4a148c
    classDef llm fill:#fce4ec,stroke:#c62828,color:#b71c1c
    classDef infra fill:#eceff1,stroke:#546e7a,color:#263238
    classDef processing fill:#e0f2f1,stroke:#00897b,color:#004d40

    class REST,WS client
    class DRF,Channels django
    class Router,Retriever,QA,Research,Summarise,Analyse agent
    class PG,Qdrant,Redis storage
    class Azure,Bedrock llm
    class K8s,Prom,Graf infra
    class Celery,Beat processing
